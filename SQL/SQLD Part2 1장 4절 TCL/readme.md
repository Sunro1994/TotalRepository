# SQLD [과목2] 1장 4절 TCL

작성일시: 2023년 9월 1일 오후 9:21
종류: SQL
복습: No

## 🟰 트랜잭션

- [ ]  **`트랜잭션`**
    
    데이터베이스의 논리적 연산단위
    
    밀접히 관련되어 분리될 수 없는 한 개 이상의 데이터베이스 조작
    
    하나의 트랜잭션에는 하나 이상의 SQL문장이 포함된다.
    
    트랜잭션은 분할할 수 없는 최소의 단위
    
    전부 적용하거나 전부 취소, ALL or NOTHING
    
- [ ]  TCL(Transaction  Control Language)
    1. Commit : 올바르게 반영된 데이터를 DB에 반영
    2. Rollback : 트랜잭션 시작 이전의 상태로 되돌리는 것
    3. 저장점(SAVEPOINT)

- [ ]  트랜잭션 대상이 되는 SQL
    1. UPDATE, INSERT, DELETE 등 DB를 수정하는 DML문
    2. SELECT FOR UPDATE등 배타적 LOCK을 요구하는 SELECT문
    
- [ ]  트랜잭션 특징(ACID)
    1. 원자성(Atomicity) : All or Nothing
    2. 일관성(Consistency) : 트랜잭션이 실행되기 전 DB에 이상이 없다면 이후에도 없어야 한다.
    3. 고립성(Isolidity) : 트랜잭션이 실행되는 도중에 다른 트랜잭션의 영향을 받아선 안된다.
    4. 지속성(Durability) : 트랜잭션이 성공적으로 수행되면 영구적으로 저장된다.

## 🟰Commit(커밋)

입력, 수정, 삭제한 자료에 대한 문제가 없을 경우 COMMIT명령어를 통해서 트랜잭션을 완료한다.

- [ ]  COMMIT 이나 ROLLBACK 이전의 데이터 상태
    
    단지 메모리 BEFFER에만 영향을 주고 데이터 변경 이전 상태로 복구 가능하다
    
    현재 사용자는 SELECT 문으로 변경 결과를 확인할 수 있다.
    
    다른 사용자는 현재 사용자가 수행한 결과를 볼 수 없다.
    
    변경된 행은 잠금(LOCKING)이 설정되어 다른 사용자가 변경할 수 없다.
    
- [ ]  COMMIT 이후의 데이터 상태
    
    데이터에 대한 변경 사항이 데이터베이스에 반영된다.
    
    이전 데이터는 영원히 잃어버린다.
    
    모든 사용자가 결과를 볼 수 있다.
    
    관련된 행에 잠금이 풀리고, 다른 사용자가 행을 조작할 수 있다.
    

## 🟰ROLLBACK(롤백)

테이블 내 입력, 수정, 삭제에 대한 데이터에 대해서 COMMIT이전에 변경 사항을 취소할 수 있는 기능

데이터 변경 사항 취소, 관련된 행에 대한 잠금이 풀리고 다른 사용자들이 데이터를 변경할 ㅜㅅ 있다.

- [ ]  롤백 후 데이터의 상태
    
    데이터에 대한 변경 사항은 취소
    
    이전 데이터는 다시 재저장
    
    관련된 행에 대한 잠금이 풀리고, 다른 사용자들이 행을 조작할 수 있다.
    
- [ ]  COMMIT/ROLLBACK을 사용함으로써 얻을 수 있는 효과
    
    데이터 무결성 보장
    
    영구적인 변경을 하기 전 데이터의 변경 사항 확인 가능
    
    논리적으로 연관된 작업을 그룹화하여 처리 가능
    

## SAVEPOINT(저장점)

저장점을 정의하면 롤백할 떄 전체 롤백이 아닌 일부만 롤백할 수 있다.

- [ ]  특징
    
    복수의 저장점을 정의가능
    
    동일 이름으로 저장점을 저장시 나중에 정의한 저장점이 유효하다
    
    저장점 정의하고 저장점으로 롤백하기
    
- [ ]  예시
    
    ```sql
    --ORACLE
    SAVEPOINT SVPT1;
    
    ROLLBACK TO SVPT1;
    
    --SQL SERVER
    SAVE TRANSACTION SVTR1;
    
    ROLLBACK TRANSACTION SVTR1;
    
    ```
    

SAVEPOINT 설정 후 ROLLBACK이 이뤄지는 범위

![https://postfiles.pstatic.net/20151204_215/liberty264_1449237811857XkkO7_JPEG/1.jpg?type=w3](https://postfiles.pstatic.net/20151204_215/liberty264_1449237811857XkkO7_JPEG/1.jpg?type=w3)

📌 저장점 A로 되돌리고 나서 다시 B와 같은 미래로 되돌릴 수 없다.

📌 특정 저장점까지 롤백하면 그 저장점 이후에 설정한 저장점은 무효가 된다.

📌 저장점 없이 롤백하면 모든 변경 사항을 취소한다.