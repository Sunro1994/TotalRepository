# SQLD [과목1] 2장 3절 반정규화를 통한 성능향상 전략

작성일시: 2023년 8월 24일 오후 9:07
종류: SQL
복습: No

## 🟰 반 정규화를 통한 성능향상 전략

- [ ]  반정규화의 정의
    
    정규화된 엔터티, 속성, 관계에 대해 시스템의 성능향상, 개발과 운영의 단순화를 위해 통합
    
    , 분리, 중복등을 수행하는 데이터 모델링의 기법
    
- [ ]  협의의 반정규화
    
    데이터를 중복하여 성능을 향상시키는 기법
    
    더 넓은 의미로는 성능을 향상시키기 위해 정규화된 데이터 모데에서 중복,통합,분리 등을 수행하는 모든 과정을 의미
    
- [ ]  반정규화를 하는 의미
    
    데이터 무결성이 깨질 수 있지만 디스크 I/O량이 너무 많아서 성능이 저하되거나 경로가 너무 멀어 조인으로 인한 성능 저하가 예상되는 경우 수행한다.
    
    ![https://postfiles.pstatic.net/20151204_146/liberty264_1449228062086L5dJ5_JPEG/1.jpg?type=w3](https://postfiles.pstatic.net/20151204_146/liberty264_1449228062086L5dJ5_JPEG/1.jpg?type=w3)
    
- [ ]  비정규화를 기술적으로 수행하지 않은 경우 문제점
    
    성능이 저하된 데이터베이스의 생성
    
    구축단계나 시험단계에서 반정규화를 적용할 때 수정에 따른 노력비용이 많이 들게된다.
    

- [ ]  반정규화 적용 방법
    
    ![https://postfiles.pstatic.net/20151204_134/liberty264_1449228223925fuEEt_JPEG/2.jpg?type=w3](https://postfiles.pstatic.net/20151204_134/liberty264_1449228223925fuEEt_JPEG/2.jpg?type=w3)
    
    1. 반정규화의 대상 조사
        1. 데이터가 대량이고 성능이 저하될것이라고 예상되는 경우 4가지를 고려하여 반정규화를 수행한다.
            1. 자주 사용되는 테이블에 접근하는 프로세스의 수가 많고 항상 일정한 범위만을 조회하는 경우
            2. 테이블에 대량의 데이터가 있고 대량의 데이터 범위를 자주 처리하는 경우 처리범위를 일정하게 줄이지 않으면 성능을 보장할 수 없는 경우
            3. 통계성 프로세스에 의해 통계 정보를 필요로 할 때 별도의 통계 테이블을 생성(반정규화 테이블)
            4. 테이블에 지나치게 많은 조인이 걸려 데이터를 조회하는 작업이 기술적으로 어려울 경우 
    2. 반 정규화의 대상에 대해 다른 방법으로 처리할 수 있는지 검토
        1. 가급적이면 데이터의 중복으로 데이터의 무결성이 깨지는 위험을 감수하기 위해 반정규화를 결정하기 이전에 다른 방법을 모색한다.
        2. 지나치게 많은 조인이 걸려 데이터를 조회하는 작업이 기술적으로 어려운 경우 VIEW를 사용하면 해결할 수도 있다. 뷰가 조회의 성능을 향상시키는 역할을 수행하지는 않지만 개발자 별로 SQL문장을 만드는 방법에 따라 성능저하가 나타날 수 있으므로 성ㄴ으을 고려한 뷰를 생성하여 개발자가 뷰를 통해 접근하게 함으로써 성능저하의 위험을 예방시키는 법도 좋은 방법
        3. 대량의 데이터처리나 부분처리에 의해 성능이 저하되는 경우 클러스터링을 적용하거나 인덱스를 조정함으로써 성능을 향상시킬 수 있다. 클러스터링을 적용하는 경우 대량의 데이터를 특정 클러스터링 팩트에 의해 저장방식을 다르게 하는 방법
        이 방법의 경우 입력/수정/삭제하는 경우 성능이 많이 저하되므로 조회중심의 테이블이 아니라면 생성하면 안되는 오브젝트이다.
        하지만 조회가 대부분이고 인덱스를 통해 성능향상이 불가능하다면 클러스터링을 고려할 만하다.
        또한 인덱스를 통해 성능을 충분히 확보할 수 있다면 인덱스를 조정하여 반정규화를 피하도록 한다.
        
        4.  대량의 데이터는 PK의 성격에 따라 부분적인 테이블로 분리할 수 있다.
        즉, 파티셔닝 저장기법에 따라 성능을 향상시킬 수 있는 파티셔닝을 고려해 볼 수 있다.
        이경우 데이터가 특정 기준(파티셔닝 키)에 따라 다르게 저장되고 파티셔닝 키에 따른 조회가 될 떄 성능이 좋아지는 특성이 있다.
        따라서, 특정 기준에 의해 물리적인 저장공간이 구분될 수 있고 트랜잭션이 들어올 떄 일정한 기준에 의해 들어온다면 파티셔닝 테이블을 적용하여 조회의 성능을 향상시크는 좋은 방법이 있다.
    3. 반 정규화를 적용
        1. 사전에 충분한 검토를 통해 적용판단이 섰다면 세가지 규칙을 고려하여 적용하도록 한다.
        테이블,속성,관계에 대해 적용할 수 있으며, 관계를 추가할 수도 있고 분할 할수도 있고 제거할 수도 있다.
        2. 성능을 향상시킬 수 있는 포괄적인 방법을 적용하여 반정규화를 적용하는 것이 전문화된 반정규화의 기법임을 기억하자
    

## 🟰반정규화 기법

- [ ]  테이블의 반정규화
    
    ![https://postfiles.pstatic.net/20151204_290/liberty264_14492285091081A0gw_JPEG/3.jpg?type=w3](https://postfiles.pstatic.net/20151204_290/liberty264_14492285091081A0gw_JPEG/3.jpg?type=w3)
    
- [ ]  칼럼의 반정규화
    
    ![https://postfiles.pstatic.net/20151204_219/liberty264_1449228591390SppPt_JPEG/4.jpg?type=w3](https://postfiles.pstatic.net/20151204_219/liberty264_1449228591390SppPt_JPEG/4.jpg?type=w3)
    
- [ ]  관계 반정규화
    
    ![https://postfiles.pstatic.net/20151204_281/liberty264_1449228800576fuoCA_JPEG/5.jpg?type=w3](https://postfiles.pstatic.net/20151204_281/liberty264_1449228800576fuoCA_JPEG/5.jpg?type=w3)
    

## 🟰정규화가 잘 정의된 데이터 모델에서 성능이 저하될 수 있는 경우

✅문제의 테이블

- [ ]  문제점
    1. 공급자와 전화번호, 메일주소, 위치는 1:M의 관계이므로 한 명의 공급자당 여러 개의 전화번호, 메일주소, 위치가 존재한다.
    2. 가장 최근에 변경된 값을 가져오기 위해서는 조금 복잡한 조인이 발생한다.

![https://postfiles.pstatic.net/20151204_192/liberty264_1449228894745eMNfz_JPEG/6.jpg?type=w3](https://postfiles.pstatic.net/20151204_192/liberty264_1449228894745eMNfz_JPEG/6.jpg?type=w3)

- [ ]  복잡한 조인 구문
    
    ```sql
    SELECT A.공급자명, B.전화번호, C.메일주소, D.위치
    
      FROM 공급자 A,
    
           (SELECT X.공급자번호,  X.전화번호
    
              FROM 전화번호 X,
    
                   (SELECT 공급자번호, MAX(순번) 순번
    
                      FROM 전화번호
    
                     WHERE 공급자번호 BETWEEN '1001' AND '1005'
    
                     GROUP BY 공급자번호) Y
    
             WHERE X.공급자번호 = Y.공급자번호
    
               AND X.순번 = Y.순번) B,
    
           (SELECT X.공급자번호,  X.메일주소
    
              FROM 메일주소 X,
    
                   (SELECT 공급자번호, MAX(순번) 순번
    
                      FROM 메일주소
    
                     WHERE 공급자번호 BETWEEN '1001' AND '1005'
    
                     GROUP BY 공급자번호) Y
    
             WHERE X.공급자번호 = Y.공급자번호
    
               AND X.순번 = Y.순번) C,
    
           (SELECT X.공급자번호,  X.위치
    
              FROM 위치 X,
    
                   (SELECT 공급자번호,  MAX(순번) 순번
    
                      FROM 위치
    
                     WHERE 공급자번호 BETWEEN '1001' AND '1005'
    
                     GROUP BY 공급자번호) Y
    
             WHERE X.공급자번호 = Y.공급자번호
    
               AND X.순번 = Y.순번) D
    
     WHERE A.공급자번호 = B.공급자번호
    
       AND A.공급자번호 = C.공급자번호
    
       AND A.공급자번호 = D.공급자번호
    
       AND A.공급자번호 BETWEEN '1001' AND '1005';
    [출처] 제 3절 반정규화와 성능|작성자 지그드시
    ```
    

✅반정규화를 적용하여 가장 최근에 변경된 값을 마스터에 위치

![https://postfiles.pstatic.net/20151204_95/liberty264_1449228974771PMFLU_JPEG/8.jpg?type=w3](https://postfiles.pstatic.net/20151204_95/liberty264_1449228974771PMFLU_JPEG/8.jpg?type=w3)

```sql
SELECT 공급자명, 전화번호, 메일주소, 위치

  FROM 공급자

 WHERE 공급자번호 BETWEEN '1001' AND '1005'

[출처] 제 3절 반정규화와 성능|작성자 지그드시
```

## 🟰정규화가 잘 정의된 데이터 모델에서 성능이 저하된 경우

- [ ]  문제점
    
    업무의 영역이 커지고 다른 업무와 인터페이스가 많아짐에 따라 데이터베이스 서버가 여러대인 경우가 있다. DB서버가 분리되어 분산데이터베이스가 구서오디었을 때 반정규화를 통해 성능을 향상 시킬 수 있다.
    
    ![https://postfiles.pstatic.net/20151204_27/liberty264_1449229054004MScxL_JPEG/9.jpg?type=w3](https://postfiles.pstatic.net/20151204_27/liberty264_1449229054004MScxL_JPEG/9.jpg?type=w3)
    
    ```sql
    SELECT C.부서명,  A.연계상태코드
    
      FROM 연계 A,
    
           접수 B,
    
           부서 C  <== 서버A와 서버B가 조인이 걸림
    
     WHERE A.부서코드 = B.부서코드
    
       AND A.접수번호 = B.접수번호
    
       AND B.부서코드 = C.부서코드
    
       AND A.연계일자 BETWEEN '20040801' AND '20040901';
    [출처] 제 3절 반정규화와 성능|작성자 지그드시
    ```
    
    오라클의 경우 DB LINK조인이 발생하여 일반조인보다 성능이 저하된다.
    
    ✅반정규화를 진행한 테이블
    
    ![https://postfiles.pstatic.net/20151204_136/liberty264_1449229178013coN6h_JPEG/10.jpg?type=w3](https://postfiles.pstatic.net/20151204_136/liberty264_1449229178013coN6h_JPEG/10.jpg?type=w3)
    

```sql
SELECT 부서명, 연계상태코드

  FROM 연계

 WHERE 연계일자 BETWEEN '20040801' AND '20040901';
[출처] 제 3절 반정규화와 성능|작성자 지그드시
```

## 🟰결론

- [ ]  반정규화 진행시 입력, 수정, 삭제를 할 때에는 성능이 떨어지는 점을 기억한다
- [ ]  무결성 유지에 주의를 해야 한다.